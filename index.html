<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Investment-Pitch Dashboard</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 2em; background: #f8f9fb;}
        h1 { color: #2c3e50;}
        table { border-collapse: collapse; width: 100%; margin-bottom: 1.5em;}
        th, td { padding: 0.8em 1em; border: 1px solid #ccc; }
        th { background: #e7ecef; }
        .section { margin-bottom: 2em; }
        .pitch-details { background: #f2f6fa; padding: 1em; border-radius: 8px;}
        .todo { color: #1b7b34; }
    </style>
</head>
<body>
<h1>Daily Investment-Pitch Dashboard</h1>
<div class="section">
    <h2>Übersicht aller Pitches</h2>
    <table id="overview">
        <tr>
            <th>Pitch-Name</th>
            <th>Letztes Update</th>
            <th>Aktueller Kurs</th>
            <th>Status/Kommentar</th>
        </tr>
        <!-- Zeilen werden per JS hinzugefügt -->
    </table>
</div>
<div class="section pitch-details" id="details">
    <h2>Detail-Updates</h2>
    <!-- Pitch-Detailblöcke werden per JS hinzugefügt -->
</div>
<script>
// Unternehmensliste mit Ticker-Symbolen
const companies = [
    { name: 'ANGI Inc.', symbol: 'ANGI', exchange: 'NASDAQ' },
    { name: 'IAC Inc', symbol: 'IAC', exchange: 'NASDAQ' },
    { name: 'Northern Dynasty Minerals', symbol: 'NAK', exchange: 'NYSEAMERICAN' }
];

// Funktion zum Laden von Live-Finanzdaten
async function fetchCompanyData(symbol) {
    try {
        // Verwende Yahoo Finance Alternative API (kostenlos, kein API-Key nötig)
        const response = await fetch(`https://api.allorigins.win/raw?url=https://query1.finance.yahoo.com/v8/finance/chart/${symbol}?interval=1d&range=5d`);
        const data = await response.json();
        
        if (data.chart && data.chart.result && data.chart.result[0]) {
            const result = data.chart.result[0];
            const meta = result.meta;
            const quote = result.indicators.quote[0];
            
            // Aktuelle Preisdaten
            const currentPrice = meta.regularMarketPrice || 'N/A';
            const previousClose = meta.previousClose || 'N/A';
            const change = currentPrice !== 'N/A' && previousClose !== 'N/A' 
                ? ((currentPrice - previousClose) / previousClose * 100).toFixed(2) 
                : 'N/A';
            
            return {
                price: currentPrice,
                change: change,
                volume: meta.regularMarketVolume || 'N/A',
                marketCap: meta.marketCap || 'N/A'
            };
        }
    } catch (error) {
        console.error(`Fehler beim Laden von ${symbol}:`, error);
    }
    return null;
}

// Funktion zum Abrufen der neuesten News
// Funktion zum Abrufen der neuesten News von Yahoo Finance
async function fetchCompanyNews(symbol) {
    try {
        // Yahoo Finance News API via CORS Proxy
        const response = await fetch(`https://api.allorigins.win/raw?url=https://query1.finance.yahoo.com/v1/finance/search?q=${symbol}&quotesCount=1&newsCount=5`);
        const data = await response.json();
        
        if (data.news && data.news.length > 0) {
            // Nehme nur die ersten 3 relevantesten News
            const relevantNews = data.news.slice(0, 3).map(item => ({
                title: item.title,
                url: item.link,
                publisher: item.publisher || 'Yahoo Finance',
                publishTime: new Date(item.providerPublishTime * 1000).toLocaleDateString('de-DE')
            }));
            return relevantNews;
        }
        
        return [];
    } catch (error) {
        console.error(`Fehler beim Laden der News für ${symbol}:`, error);
        return [];
    }
}

// Hauptfunktion zum Laden und Anzeigen aller Daten
async function loadDashboard() {
    const overview = document.getElementById('overview');
    const details = document.getElementById('details');
    
    // Ladeanzeige
    overview.innerHTML = '<tr><td colspan="4" style="text-align:center;">Lade aktuelle Daten...</td></tr>';
    details.innerHTML = '<p>Lade Details...</p>';
    
    for (const company of companies) {
        // Lade Finanzdaten
        const stockData = await fetchCompanyData(company.symbol);
        const newsData = await fetchCompanyNews(companysymbol);
        
        if (stockData) {
            // Aktuelles Datum
            const today = new Date().toLocaleDateString('de-DE');
            
            // Bestimme Status basierend auf Kursänderung
            let status = 'Neutral';
            if (stockData.change !== 'N/A') {
                const changeNum = parseFloat(stockData.change);
                if (changeNum > 2) status = 'Stark positiv ↑';
                else if (changeNum > 0) status = 'Leicht positiv ↑';
                else if (changeNum < -2) status = 'Stark negativ ↓';
                else if (changeNum < 0) status = 'Leicht negativ ↓';
            }
            
            // Fülle Tabelle
            const row = document.createElement('tr');
            row.innerHTML = `<td><strong>${company.name}</strong> (${company.symbol})</td>
                <td>${today}</td>
                <td>$${stockData.price} (${stockData.change > 0 ? '+' : ''}${stockData.change}%)</td>
                <td>${status}</td>`;
            overview.appendChild(row);
            
            // Fülle Details
            const block = document.createElement('div');
            block.innerHTML = `<h3>${company.name} (${company.symbol})</h3>
                <ul>
                    <li><strong>Aktueller Kurs:</strong> $${stockData.price}</li>
                    <li><strong>Tagesänderung:</strong> ${stockData.change}%</li>
                    <li><strong>Handelsvolumen:</strong> ${new Intl.NumberFormat('de-DE').format(stockData.volume)}</li>
                    <li><strong>Marktkapitalisierung:</strong> $${new Intl.NumberFormat('de-DE').format(stockData.marketCap)}</li>
                    <li><strong>Letztes Update:</strong> ${today} (Live-Daten)</li>
                                    <li><strong>Aktuelle News:</strong></li>
                                                    ${newsData && newsData.length > 0 ? newsData.map(news => `
                    <li style="margin-left: 20px; margin-bottom: 8px;">
                        <a href="${news.url}" target="_blank" style="color: #0066cc; text-decoration: none;">
                            ${news.title}
                        </a>
                        <br><small style="color: #666;">${news.publisher} - ${news.publishTime}</small>
                    </li>
                `).join('') : '<li style="margin-left: 20px;"><em>Keine Neuigkeiten</em></li>'}
                </ul>`;
            details.appendChild(block);
        }
    }
}

// Dashboard beim Laden der Seite initialisieren
loadDashboard();

// Optional: Alle 5 Minuten aktualisieren
// Aktualisierung nur um 12:00 und 18:00 Uhr
function scheduleNextUpdate() {
    const now = new Date();
    const currentHour = now.getHours();
    const currentMinute = now.getMinutes();
    
    let nextUpdateHour;
    if (currentHour < 12 || (currentHour === 12 && currentMinute === 0)) {
        nextUpdateHour = 12;
    } else if (currentHour < 18 || (currentHour === 18 && currentMinute === 0)) {
        nextUpdateHour = 18;
    } else {
        // Nächster Update ist morgen um 12:00
        nextUpdateHour = 12 + 24;
    }
    
    const nextUpdate = new Date(now);
    nextUpdate.setHours(nextUpdateHour % 24, 0, 0, 0);
    if (nextUpdateHour >= 24) {
        nextUpdate.setDate(nextUpdate.getDate() + 1);
    }
    
    const timeUntilUpdate = nextUpdate - now;
    
    setTimeout(() => {
        loadDashboard();
        scheduleNextUpdate();
    }, timeUntilUpdate);
}

scheduleNextUpdate();
</script>>
</body>
</html>
<!-- Force rebuild -->
